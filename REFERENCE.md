# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

#### Public Classes

* [`nomad`](#nomad): Installs, configures, and manages nomad

#### Private Classes

* `nomad::config`: This class is called from nomad::init to install the config file.
* `nomad::install`: This class is called from nomad::init to install the config file.
* `nomad::reload_service`: This class is meant to be called from certain configuration changes that support reload.
* `nomad::run_service`: This class is meant to be called from nomad It ensure the service is running

### Functions

* [`nomad::nomad_sorted_json`](#nomadnomad_sorted_json): This function takes unsorted hash and outputs JSON object making sure the keys are sorted.
* [`nomad::sorted_json`](#nomadsorted_json): This function takes unsorted hash and outputs JSON object making sure the keys are sorted.

## Classes

### `nomad`

Installs, configures, and manages nomad

#### Examples

##### To set up a single nomad server, with several agents attached, on the server.

```puppet
class { 'nomad':
  version     => '1.0.2', # check latest version at https://github.com/hashicorp/nomad/blob/master/CHANGELOG.md
  config_hash => {
    'region'     => 'us-west',
    'datacenter' => 'ptk',
    'log_level'  => 'INFO',
    'bind_addr'  => '0.0.0.0',
    'data_dir'   => '/opt/nomad',
    'server'     => {
      'enabled'          => true,
      'bootstrap_expect' => 3,
    }
  }
}
```

##### On the agent(s)

```puppet
class { 'nomad':
  config_hash => {
      'region'     => 'us-west',
      'datacenter' => 'ptk',
      'log_level'  => 'INFO',
      'bind_addr'  => '0.0.0.0',
      'data_dir'   => '/opt/nomad',
      'client'     => {
      'enabled'    => true,
      'servers'    => [
        "nomad01.your-org.pvt:4647",
        "nomad02.your-org.pvt:4647",
        "nomad03.your-org.pvt:4647"
      ]
    }
  },
}
```

##### Install as package from the HashiCorp repositories

```puppet
class { 'nomad':
  install_method => 'package',
  bin_dir        => '/bin',
  manage_repo    => true,
  package_ensure => installed,
  config_hash    => {
    'region'     => 'us-west',
    'datacenter' => 'ptk',
    'log_level'  => 'INFO',
    'bind_addr'  => '0.0.0.0',
    'data_dir'   => '/opt/nomad',
    'client'     => {
    'enabled'    => true,
    'servers'    => [
        "nomad01.your-org.pvt:4647",
        "nomad02.your-org.pvt:4647",
        "nomad03.your-org.pvt:4647"
      ]
    }
  },
}
```

##### Disable install and service components

```puppet
class { 'nomad':
  install_method => 'none',
  manage_service => false,
  config_hash   => {
    'region'     => 'us-west',
    'datacenter' => 'ptk',
    'log_level'  => 'INFO',
    'bind_addr'  => '0.0.0.0',
    'data_dir'   => '/opt/nomad',
    'client'     => {
    'enabled'    => true,
    'servers'    => [
        "nomad01.your-org.pvt:4647",
        "nomad02.your-org.pvt:4647",
        "nomad03.your-org.pvt:4647"
      ]
    }
  },
}
```

#### Parameters

The following parameters are available in the `nomad` class.

##### `arch`

Data type: `String[1]`

cpu architecture

##### `purge_config_dir`

Data type: `Boolean`

Purge config files no longer generated by Puppet

Default value: ``true``

##### `join_wan`

Data type: `Optional[String[1]]`

join nomad cluster over the WAN

Default value: ``undef``

##### `bin_dir`

Data type: `Stdlib::Absolutepath`

location of the nomad binary

Default value: `'/usr/local/bin'`

##### `version`

Data type: `String[1]`

Specify version of nomad binary to download.

Default value: `'1.0.2'`

##### `install_method`

Data type: `Enum['url', 'package', 'none']`

install via system package, download and extract from a url.

Default value: `'url'`

##### `os`

Data type: `String[1]`

operation system to install for

Default value: `downcase($facts['kernel'])`

##### `download_url`

Data type: `Optional[String[1]]`

download url to download from

Default value: ``undef``

##### `download_url_base`

Data type: `String[1]`

download hostname to down from

Default value: `'https://releases.hashicorp.com/nomad/'`

##### `download_extension`

Data type: `String[1]`

archive type to download

Default value: `'zip'`

##### `package_name`

Data type: `String[1]`

Only valid when the install_method == package.

Default value: `'nomad'`

##### `package_ensure`

Data type: `String[1]`

Only valid when the install_method == package.

Default value: `'installed'`

##### `config_dir`

Data type: `Stdlib::Absolutepath`

location of the nomad configuration

Default value: `'/etc/nomad'`

##### `extra_options`

Data type: `String`

Extra arguments to be passed to the nomad agent

Default value: `''`

##### `config_hash`

Data type: `Hash`

Use this to populate the JSON config file for nomad.

Default value: `{}`

##### `config_defaults`

Data type: `Hash`

default set of config settings

Default value: `{}`

##### `config_mode`

Data type: `Stdlib::Filemode`

Use this to set the JSON config file mode for nomad.

Default value: `'0660'`

##### `manage_repo`

Data type: `Boolean`

Configure the upstream HashiCorp repository. Only relevant when $nomad::install_method = 'package'.

Default value: ``true``

##### `manage_service`

Data type: `Boolean`

manage the nomad service

Default value: ``true``

##### `pretty_config`

Data type: `Boolean`

Generates a human readable JSON config file.

Default value: ``false``

##### `pretty_config_indent`

Data type: `Integer`

Toggle indentation for human readable JSON file.

Default value: `4`

##### `service_enable`

Data type: `Boolean`

enable the nomad service

Default value: ``true``

##### `service_ensure`

Data type: `Stdlib::Ensure::Service`

ensure the state of the nomad service

Default value: `'running'`

##### `restart_on_change`

Data type: `Boolean`

Determines whether to restart nomad agent on $config_hash changes. This will not affect reloads when service, check or watch configs change.

Default value: ``true``

## Functions

### `nomad::nomad_sorted_json`

Type: Ruby 4.x API

---- original file header ----

Optionally you can pass 2 additional parameters, pretty generate and indent length.

*Examples:*

   -------------------
   -- UNSORTED HASH --
   -------------------
   unsorted_hash = {
     'client_addr' => '127.0.0.1',
     'bind_addr'   => '192.168.34.56',
     'start_join'  => [
       '192.168.34.60',
       '192.168.34.61',
       '192.168.34.62',
     ],
     'ports'       => {
       'rpc'   => 8567,
       'https' => 8500,
       'http'  => -1,
     },
   }

   -----------------
   -- SORTED JSON --
   -----------------

   nomad_sorted_json(unsorted_hash)

   {"bind_addr":"192.168.34.56","client_addr":"127.0.0.1",
   "ports":{"http":-1,"https":8500,"rpc":8567},
   "start_join":["192.168.34.60","192.168.34.61","192.168.34.62"]}

   ------------------------
   -- PRETTY SORTED JSON --
   ------------------------
   Params: data <hash>, pretty <true|false>, indent <int>.

   nomad_sorted_json(unsorted_hash, true, 4)

   {
       "bind_addr": "192.168.34.56",
       "client_addr": "127.0.0.1",
       "ports": {
           "http": -1,
           "https": 8500,
           "rpc": 8567
       },
       "start_join": [
           "192.168.34.60",
           "192.168.34.61",
           "192.168.34.62"
       ]
   }

#### `nomad::nomad_sorted_json(Any *$args)`

---- original file header ----

Optionally you can pass 2 additional parameters, pretty generate and indent length.

*Examples:*

   -------------------
   -- UNSORTED HASH --
   -------------------
   unsorted_hash = {
     'client_addr' => '127.0.0.1',
     'bind_addr'   => '192.168.34.56',
     'start_join'  => [
       '192.168.34.60',
       '192.168.34.61',
       '192.168.34.62',
     ],
     'ports'       => {
       'rpc'   => 8567,
       'https' => 8500,
       'http'  => -1,
     },
   }

   -----------------
   -- SORTED JSON --
   -----------------

   nomad_sorted_json(unsorted_hash)

   {"bind_addr":"192.168.34.56","client_addr":"127.0.0.1",
   "ports":{"http":-1,"https":8500,"rpc":8567},
   "start_join":["192.168.34.60","192.168.34.61","192.168.34.62"]}

   ------------------------
   -- PRETTY SORTED JSON --
   ------------------------
   Params: data <hash>, pretty <true|false>, indent <int>.

   nomad_sorted_json(unsorted_hash, true, 4)

   {
       "bind_addr": "192.168.34.56",
       "client_addr": "127.0.0.1",
       "ports": {
           "http": -1,
           "https": 8500,
           "rpc": 8567
       },
       "start_join": [
           "192.168.34.60",
           "192.168.34.61",
           "192.168.34.62"
       ]
   }

Returns: `Data type` Describe what the function returns here

##### `*args`

Data type: `Any`

The original array of arguments. Port this to individually managed params
to get the full benefit of the modern function API.

### `nomad::sorted_json`

Type: Ruby 4.x API

This function takes unsorted hash and outputs JSON object making sure the keys are sorted.

#### `nomad::sorted_json(Optional[Hash] $unsorted_hash = {}, Optional[Boolean] $pretty = false, Optional[Integer] $indent_len = 4)`

The nomad::sorted_json function.

Returns: `Hash` sorted json

##### `unsorted_hash`

Data type: `Optional[Hash]`

unstructured input

##### `pretty`

Data type: `Optional[Boolean]`

make output human readable

##### `indent_len`

Data type: `Optional[Integer]`

number of characters to indent

